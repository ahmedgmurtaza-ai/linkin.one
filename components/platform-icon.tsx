import {
  Twitter,
  Linkedin,
  Github,
  Instagram,
  Youtube,
  Facebook,
  Globe,
  Mail,
  MessageCircle,
  Send,
  Music,
  FileText,
  Link as LinkIcon,
  Brush,
  Palette,
  BookOpen,
  Newspaper,
  Code2,
  Video,
  type LucideIcon,
} from "lucide-react";
import { getFaviconUrl, isWebsiteLink } from "@/lib/favicon-utils";
import Image from "next/image";
import { useState } from "react";

interface PlatformIconProps {
  platform: string;
  className?: string;
  showColor?: boolean;
  url?: string;
}

// Custom SVG icons for platforms
const CustomIcons = {
  Medium: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z" />
    </svg>
  ),
  DevTo: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M7.42 10.05c-.18-.16-.46-.23-.84-.23H6l.02 2.44.04 2.45.56-.02c.41 0 .63-.07.83-.26.24-.24.26-.36.26-2.2 0-1.91-.02-1.96-.29-2.18zM0 4.94v14.12h24V4.94H0zM8.56 15.3c-.44.58-1.06.77-2.53.77H4.71V8.53h1.4c1.67 0 2.16.18 2.6.9.27.43.29.6.32 2.57.05 2.23-.02 2.73-.47 3.3zm5.09-5.47h-2.47v1.77h1.52v1.28l-.72.04-.75.03v1.77l1.22.03 1.2.04v1.28h-1.6c-1.53 0-1.6-.01-1.87-.3l-.3-.28v-3.16c0-3.02.01-3.18.25-3.48.23-.31.25-.31 1.88-.31h1.64v1.3zm4.68 5.45c-.17.43-.64.79-1 .79-.18 0-.45-.15-.67-.39-.32-.32-.45-.63-.82-2.08l-.9-3.39-.45-1.67h.76c.4 0 .75.02.75.05 0 .06 1.16 4.54 1.26 4.83.04.15.32-.7.73-2.3l.66-2.52.74-.04c.4-.02.73 0 .73.04 0 .14-1.67 6.38-1.8 6.68z" />
    </svg>
  ),
  TikTok: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z" />
    </svg>
  ),
  Spotify: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z" />
    </svg>
  ),
  Dribbble: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm8.66 6.85c1.02 1.27 1.67 2.84 1.81 4.55-2.54-.54-4.88-.54-6.97.03-.21-.51-.42-1.02-.66-1.53 2.42-1.02 4.26-2.34 5.82-3.05zM12 2.07c2.11 0 4.04.75 5.55 2-1.35.6-3.03 1.8-5.28 2.73-1.35-2.48-2.82-4.47-3.99-5.67.87-.06 1.77-.06 2.72-.06zm-4.92.93c1.14 1.23 2.58 3.21 3.93 5.64-2.97.84-6.27 1.26-9.57 1.26h-.42C2.07 7.05 4.02 4.44 7.08 3zM2.07 12v-.27c3.48 0 7.05-.48 10.35-1.44.21.42.39.87.57 1.29-3.66 1.17-6.57 3.63-8.61 6.24-1.5-1.65-2.31-3.81-2.31-5.82zm9.93 9.93c-2.22 0-4.26-.75-5.91-2.01 1.8-2.43 4.47-4.74 7.83-5.88.99 2.7 1.65 5.52 1.89 8.13-.93.51-1.98.76-3.81.76zm5.91-1.53c-.27-2.46-.87-5.07-1.8-7.53 1.89-.3 3.93-.27 6.18.18-.48 3.24-2.1 6.09-4.38 7.35z" />
    </svg>
  ),
  Behance: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M6.938 4.503c.702 0 1.34.06 1.92.188.577.13 1.07.33 1.485.61.41.28.733.65.96 1.12.225.47.34 1.03.34 1.68 0 .74-.17 1.36-.507 1.86-.338.5-.837.9-1.502 1.22.906.26 1.576.72 2.022 1.37.448.66.665 1.45.665 2.36 0 .75-.13 1.39-.41 1.93-.28.55-.67 1-1.16 1.35-.48.348-1.05.6-1.67.76-.61.16-1.25.24-1.92.24H0V4.51h6.938v-.007zM3.495 8.08h2.83c.62 0 1.14-.13 1.56-.35.42-.226.63-.65.63-1.26 0-.57-.18-.99-.54-1.25-.36-.25-.84-.38-1.44-.38H3.495v3.24zm0 7.17h3.05c.65 0 1.17-.13 1.56-.38s.58-.7.58-1.31c0-.59-.16-1.02-.49-1.29-.33-.27-.78-.41-1.33-.41H3.495v3.39zm13.73-11.24h5.62v1.15h-5.62v-1.15zm-.48 9.57c.27.38.68.57 1.24.57.43 0 .79-.11 1.07-.34.29-.23.44-.47.48-.71h2.3c-.36 1.14-.92 1.93-1.67 2.39-.76.46-1.66.69-2.7.69-.72 0-1.37-.11-1.95-.32-.59-.21-1.09-.53-1.5-.94-.41-.42-.73-.93-.95-1.52-.23-.6-.34-1.28-.34-2.04 0-.72.11-1.38.34-1.97.23-.6.55-1.11.96-1.54.41-.43.91-.76 1.49-.98.59-.22 1.24-.33 1.95-.33.77 0 1.45.13 2.04.39.59.26 1.09.63 1.49 1.1.4.48.7 1.06.9 1.74.2.68.29 1.44.25 2.27h-6.82c0 .63.26 1.16.53 1.54z" />
    </svg>
  ),
  Substack: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M22.539 8.242H1.46V5.406h21.08v2.836zM1.46 10.812V24L12 18.11 22.54 24V10.812H1.46zM22.54 0H1.46v2.836h21.08V0z" />
    </svg>
  ),
  Discord: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M20.317 4.37a19.791 19.791 0 00-4.885-1.515.074.074 0 00-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 00-5.487 0 12.64 12.64 0 00-.617-1.25.077.077 0 00-.079-.037A19.736 19.736 0 003.677 4.37a.07.07 0 00-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 00.031.057 19.9 19.9 0 005.993 3.03.078.078 0 00.084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 00-.041-.106 13.107 13.107 0 01-1.872-.892.077.077 0 01-.008-.128 10.2 10.2 0 00.372-.292.074.074 0 01.077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 01.078.01c.12.098.246.198.373.292a.077.077 0 01-.006.127 12.299 12.299 0 01-1.873.892.077.077 0 00-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 00.084.028 19.839 19.839 0 006.002-3.03.077.077 0 00.032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 00-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z" />
    </svg>
  ),
  Telegram: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M11.944 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0a12 12 0 00-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 01.171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
    </svg>
  ),
  WhatsApp: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
    </svg>
  ),
  Twitch: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714z" />
    </svg>
  ),
  SoundCloud: ({ className }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="currentColor">
      <path d="M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.098.101.098.05 0 .09-.04.099-.098l.255-2.105-.255-2.154c-.009-.057-.049-.1-.099-.1m-.899.828c-.051 0-.091.038-.101.087L0 14.479l.176 1.339c.01.049.05.087.101.087.05 0 .09-.038.099-.087l.192-1.339-.192-1.339c-.009-.049-.049-.087-.099-.087m1.78-.208c-.06 0-.106.046-.115.106l-.217 1.533.217 1.464c.009.06.055.106.115.106.061 0 .106-.046.115-.106l.243-1.464-.243-1.533c-.009-.06-.054-.106-.115-.106m.901-.181c-.061 0-.105.04-.12.101l-.201 1.714.201 1.625c.015.061.059.101.12.101.061 0 .105-.04.119-.101l.227-1.625-.227-1.714c-.014-.061-.058-.101-.119-.101m.9-.064c-.066 0-.111.041-.125.107l-.201 1.778.201 1.682c.014.066.059.107.125.107.066 0 .111-.041.125-.107l.222-1.682-.222-1.778c-.014-.066-.059-.107-.125-.107m.902-.022c-.068 0-.111.041-.125.104l-.184 1.8.184 1.713c.014.063.057.104.125.104.066 0 .11-.041.125-.104l.206-1.713-.206-1.8c-.015-.063-.059-.104-.125-.104m.907.017c-.069 0-.112.047-.125.11l-.17 1.783.17 1.698c.013.063.056.11.125.11.066 0 .112-.047.125-.11l.19-1.698-.19-1.783c-.013-.063-.059-.11-.125-.11m.91.083c-.071 0-.116.049-.129.116l-.155 1.7.155 1.682c.013.066.058.116.129.116.064 0 .112-.05.125-.116l.172-1.682-.172-1.7c-.013-.067-.061-.116-.125-.116m.909.115c-.068 0-.115.053-.13.124l-.139 1.585.139 1.665c.015.071.062.124.13.124.067 0 .113-.053.126-.124l.157-1.665-.157-1.585c-.013-.071-.059-.124-.126-.124m.897.15c-.07 0-.117.053-.134.124l-.122 1.435.122 1.65c.017.07.064.123.134.123.072 0 .12-.053.136-.123l.142-1.65-.142-1.435c-.016-.071-.064-.124-.136-.124m.91.192c-.075 0-.124.053-.139.128l-.109 1.243.109 1.632c.015.076.064.128.139.128.07 0 .119-.052.137-.128l.122-1.632-.122-1.243c-.018-.075-.067-.128-.137-.128m.911.251c-.075 0-.125.057-.141.136l-.093 1.003.093 1.611c.016.079.066.136.141.136.074 0 .124-.057.14-.136l.106-1.611-.106-1.003c-.016-.079-.066-.136-.14-.136m.901.345c-.074 0-.125.058-.14.14l-.078.738.078 1.594c.015.082.066.14.14.14.074 0 .126-.058.143-.14l.091-1.594-.091-.738c-.017-.082-.069-.14-.143-.14m.899.47c-.074 0-.126.06-.14.143l-.062.39.062 1.561c.014.083.066.143.14.143.076 0 .128-.06.144-.143l.073-1.561-.073-.39c-.016-.083-.068-.143-.144-.143m.907.571c-.077 0-.132.063-.149.148l-.047.153.047 1.525c.017.085.072.148.149.148.082 0 .133-.063.148-.148l.058-1.525-.058-.153c-.015-.085-.066-.148-.148-.148m.901.663c-.082 0-.136.065-.15.15l-.031.047.031 1.478c.014.085.068.15.15.15.078 0 .134-.065.15-.15l.034-1.478-.034-.047c-.016-.085-.072-.15-.15-.15m2.152 1.516c-.061.01-.091.052-.091.115v1.474c0 .063.03.104.091.115.09.013.18.02.271.02 1.417 0 2.567-1.15 2.567-2.567 0-1.416-1.15-2.566-2.567-2.566-.09 0-.181.007-.271.02-.061.011-.091.053-.091.115v3.474z" />
    </svg>
  ),
};

const PLATFORM_ICON_MAP: Record<
  string,
  LucideIcon | React.FC<{ className?: string }>
> = {
  twitter: Twitter,
  x: Twitter,
  linkedin: Linkedin,
  github: Github,
  instagram: Instagram,
  youtube: Youtube,
  facebook: Facebook,
  tiktok: CustomIcons.TikTok,
  website: Globe,
  email: Mail,
  discord: CustomIcons.Discord,
  telegram: CustomIcons.Telegram,
  whatsapp: CustomIcons.WhatsApp,
  spotify: CustomIcons.Spotify,
  soundcloud: CustomIcons.SoundCloud,
  twitch: CustomIcons.Twitch,
  medium: CustomIcons.Medium,
  "dev.to": CustomIcons.DevTo,
  devto: CustomIcons.DevTo,
  substack: CustomIcons.Substack,
  dribbble: CustomIcons.Dribbble,
  behance: CustomIcons.Behance,
  resume: FileText,
  pdf: FileText,
  file: FileText,
  default: LinkIcon,
};

const PLATFORM_COLORS: Record<string, { bg: string; text: string }> = {
  twitter: { bg: "bg-[#1DA1F2]", text: "text-white" },
  x: { bg: "bg-black", text: "text-white" },
  linkedin: { bg: "bg-[#0A66C2]", text: "text-white" },
  github: { bg: "bg-[#181717]", text: "text-white" },
  instagram: {
    bg: "bg-gradient-to-br from-[#833AB4] via-[#FD1D1D] to-[#F77737]",
    text: "text-white",
  },
  youtube: { bg: "bg-[#FF0000]", text: "text-white" },
  facebook: { bg: "bg-[#1877F2]", text: "text-white" },
  tiktok: { bg: "bg-black", text: "text-white" },
  website: { bg: "bg-transparent", text: "text-black" },
  email: { bg: "bg-gray-600", text: "text-white" },
  discord: { bg: "bg-[#5865F2]", text: "text-white" },
  telegram: { bg: "bg-[#26A5E4]", text: "text-white" },
  whatsapp: { bg: "bg-[#25D366]", text: "text-white" },
  spotify: { bg: "bg-[#1DB954]", text: "text-white" },
  soundcloud: { bg: "bg-[#FF5500]", text: "text-white" },
  twitch: { bg: "bg-[#9146FF]", text: "text-white" },
  medium: { bg: "bg-black", text: "text-white" },
  "dev.to": { bg: "bg-black", text: "text-white" },
  devto: { bg: "bg-black", text: "text-white" },
  substack: { bg: "bg-[#FF6719]", text: "text-white" },
  dribbble: { bg: "bg-[#EA4C89]", text: "text-white" },
  behance: { bg: "bg-[#1769FF]", text: "text-white" },
  resume: { bg: "bg-indigo-600", text: "text-white" },
  pdf: { bg: "bg-red-600", text: "text-white" },
  file: { bg: "bg-gray-500", text: "text-white" },
  default: { bg: "bg-primary/10", text: "text-primary" },
};

export function PlatformIcon({
  platform,
  className = "h-5 w-5",
  showColor = false,
  url,
}: PlatformIconProps) {
  const [faviconError, setFaviconError] = useState(false);
  const IconComponent =
    PLATFORM_ICON_MAP[platform.toLowerCase()] || PLATFORM_ICON_MAP.default;
  const colors =
    PLATFORM_COLORS[platform.toLowerCase()] || PLATFORM_COLORS.default;

  // Check if this is a website link and we have a URL to fetch favicon from
  const shouldShowFavicon = url && isWebsiteLink(platform) && !faviconError;
  const faviconUrl = shouldShowFavicon ? getFaviconUrl(url) : null;

  if (showColor) {
    if (faviconUrl) {
      return (
        <div className="flex items-center justify-center bg-white rounded-md p-1.5">
          <Image
            src={faviconUrl}
            alt=""
            width={20}
            height={20}
            className={className}
            onError={() => setFaviconError(true)}
          />
        </div>
      );
    }
    return (
      <div
        className={`flex items-center justify-center ${colors.bg} ${colors.text} rounded-md p-1.5`}
      >
        <IconComponent className={className} />
      </div>
    );
  }

  if (faviconUrl) {
    return (
      <Image
        src={faviconUrl}
        alt=""
        width={20}
        height={20}
        className={className}
        onError={() => setFaviconError(true)}
      />
    );
  }

  return <IconComponent className={className} />;
}

export function getPlatformColors(platform: string) {
  return PLATFORM_COLORS[platform.toLowerCase()] || PLATFORM_COLORS.default;
}
